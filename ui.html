<h2>Push your modifications</h2>
<form id="send-style-changes">
  <p>Token: <input id="token" /></p>
  <button type="submit" id="send">Send</button>
</form>

<script>
  console.log("loading");
  document.getElementById("send-style-changes").onsubmit = async e => {
    e.preventDefault();
    console.log("submit");

    const colorsFileResponse = await fetch(
      "https://api.github.com/repos/Dashlane/ui-components/contents/src/globals/colors.json?ref=sync-colors"
    );

    const encodedColorsFile = await colorsFileResponse.json();
    const decodedColorsFile = window.atob(encodedColorsFile.content);
    const colors = JSON.parse(decodedColorsFile);
    colors.primary[100] = "test2";

    const postResponse = await fetch(
      "https://api.github.com/repos/Dashlane/ui-components/contents/src/globals/colors.json",
      {
        method: "PUT",
        headers: {
          Authorization: "token ${TOKEN}"
        },
        body: JSON.stringify({
          message: "feat(sync): testing update",
          content: window.btoa(JSON.stringify(colors, null, "\t")),
          branch: "sync-colors",
          sha: encodedColorsFile.sha
        })
      }
    );

    console.log(postResponse);
    const token = document.getElementById("token").value;
    parent.postMessage({ pluginMessage: { type: "push-changes", token } }, "*");
  };
</script>
